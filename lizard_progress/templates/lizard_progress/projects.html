{% extends "lizard_progress/progressbase2.html" %}

{% block extra_js %}
<style>
.projects-affix-list.affix {
  height:100px;
  top:0;
  padding-top:10px;
  background-color:#fff;
  z-index:999;
}
</style>

<script>
$(document).ready(function() {
  $('.drilldown').focus();
  if($('.drilldown').val()) {
    var query = $('.drilldown').val();
    $('.row.project').each(function(i,element) { 
      if($(element).find('a').html().toLowerCase().indexOf(query) > -1) {
        $(element).removeClass('hide');
      } else {
        $(element).addClass('hide');
      }
    });    
  }
  $('.drilldown').on('input', function(e) {
    var query = e.target.value.toLowerCase();
    $('.row.project').each(function(i,element) { 
      if($(element).find('a').html().toLowerCase().indexOf(query) > -1) {
        $(element).removeClass('hide');
      } else {
        $(element).addClass('hide');
      }
    });
  });
  $('#myAffix').affix({
    offset: {
      top: 200
    }
  });
  $('#myAffix').width($('.navbar').first().width());
});
$( window ).resize(function() {
  $('#myAffix').width($('.navbar').first().width());
});

</script>
{% endblock %}

{% block content %}
<div class="container">
  <div class="row">
    <div id="organisation" class="col-md-12">
<!--       <div class="profile-picture">
        <img data-src="holder.js/100x100" class="img-thumbnail" alt="">
      </div> -->

      <div class="organisation-title">
        <p>{{ view.organization }}<p>
      </div>

<!--       <div class="details">
        <ul>
          <li><a href="mailto:">info@{{view.organization|lower}}.nl</a></li>
          <li><a href="http://www.{{view.organization|lower}}.nl/">www.{{view.organization|lower}}.nl</a></li>
        </ul>
      </div> -->
    </div>
  </div>

</div><!-- /.container -->


    <div class="container" id="projects">


    <div class="projects-affix-list" id="myAffix">
          <div class="row">
            <div class="dropdown pull-right" >
              <ul class="nav nav-pills" role="tablist">
                <li role="presentation" class="active">
                  <a id="drop" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                    {{ view.orderby }}
                    <span class="caret"></span>
                  </a>
                  <ul id="sort" class="dropdown-menu" aria-labelledby="drop">
                    {% for queryname, choicename in view.orderchoices.items %}
                      <li><a href="?orderby={{queryname}}">{{ choicename }}</a></li>
                    {% endfor %}
                  </ul>
                </li>
              </ul>
            </div>
            <a href="{% url "lizard_progress_newproject" %}">
              <button type="button" class="btn btn-primary btn-md pull-right" style="padding:9px;margin-right:15px">
                + Project toevoegen
              </button>
            </a>
          </div>
          <div class="row">
            <input
              class="form-control drilldown"
              style="margin:20px 0 20px 20px;width:98%;"
              id="focusedInput"
              type="text"
              value=""
              placeholder="Filter projecten op naam"
            />
          </div>
    </div>

          {% for project in view.projects %}
              <div class="row project" data-url="{% url "lizard_progress_dashboardview" project.slug %}">
                <div class="col-md-8">
                  <p class="project-title">
                    <!-- <i class="fa fa-star-o"></i>&nbsp; -->
                    <a href="{% url "lizard_progress_dashboardview" project.slug %}">{{ project.name }}</a>
                  </p>
                  <p class="project-description"></p>
                  <p class="project-age" title="{{project.created_at}}">{{ project.created_at|timesince }} geleden</p>
                    {% with log=project.latest_log %}
                      {% if log %}
                        <ul class="list-inline">
                          <li class="project-latest">Laatste upload: {{ log.when|timesince }} geleden</li>
                          {% if log.mtype %}
                              <li class="project-latest"><span class="inline-pipe">met type: {{ log.mtype }}</span></li>
                          {% endif %}
                          {% if log.uploading_organization %}
                              <li class="project-latest"><span class="inline-pipe">door: {{ log.uploading_organization }}</span></li>
                          {% endif %}
                            <li class="project-latest"><span class="inline-pipe">met: {{ log.num_measurements }} meting{% if log.num_measurements == 0 or log.num_measurements > 1 %}en{% endif %}</span></li>
                        </ul>
                        {% else %}
                          <p class="project-no-latest">(Er is nog geen laatste upload.)</p>
                      {%  endif %}
                    {% endwith %}
                </div>
                <div class="col-md-4 stats">
                  <ul>
                    <li><span>Locaties compleet: {{ project.number_of_complete_locations }}x</span></li>
                    <li><div class="pie-md {{ project.pie }}"></div></li>
                  </ul>

                </div>
              </div>
          {% empty %}
            <p class="small">(Er zijn nog geen projecten)</p>
          {% endfor %}

          </div>


        </div>

      </div>

{% endblock content %}
